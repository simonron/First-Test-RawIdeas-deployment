<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex" />
	<title>Raw Ideas News Hacker App test</title>
	<script src="//code.jquery.com/jquery-1.10.2.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<!--
	<script src="jquery.tmpl.min.js" type="text/javascript"></script>
-->
	<script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-route.min.js"></script>

	<link rel="stylesheet" href="./css/desktop.css" />
	<link rel="stylesheet" href="./css/mobile.css" />
	<link rel="stylesheet" href="./css/style.css" />
	<link rel="stylesheet" href="./css/override.css" />
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">


	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://hckrnews.com/img/touch/apple-touch-icon-144x144-precomposed.png">
	<!-- For iPhone 4 with high-resolution Retina display: -->
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://hckrnews.com/img/touch/apple-touch-icon-114x114-precomposed.png">
	<!-- For first-generation iPad: -->
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://hckrnews.com/img/touch/apple-touch-icon-72x72-precomposed.png">
	<!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
	<link rel="apple-touch-icon-precomposed" href="https://hckrnews.com/img/touch/apple-touch-icon-57x57-precomposed.png">
	<!-- For nokia devices: -->
	<link rel="shortcut icon" href="https://hckrnews.com/img/touch/apple-touch-icon.png">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">

	<script>
		var Active = new Array();
		var start = 0;
		var newsItem = new Array();
		var title = "blank";
		var url = "blank";
		var count = 0;
		var score = "blank";
		var app = angular.module("myApp", []);
		var ref = new Firebase("https://hacker-news.firebaseio.com/v0/");

		for (var i = 1; i < 11; i++) {
			getNews(i);

		};

		function getNews(i) {
			var itemRef;
			ref.child('topstories').child(i).on('value', function(snapshot) {
				if (itemRef) {
					itemRef.off();
				}
				var id = snapshot.val(); //create variables for the template
				itemRef = ref.child('item').child(id);
				itemRef.on('value', function(snapshot) {

					item = snapshot.val();
					console.log(item);
					created_date = item.time;
					title = item.title;
					url = item.url;
					score = item.score;
					count = i;
					myDate = new Date(1000 * created_date);
					created_date = myDate.toLocaleString();
					newsItem = [count, title, score, url];
					$("div.hidden").remove(); //clears contents of div
					if (start > 10) {
						console.log("slot" + i + " updated");
						document.getElementById("slot" + i).parentNode.remove();
						console.log("slot" + i + " has been cleared");
						Active = i;
					}


					console.log("start = " + start + " count=" + count + " " + newsItem);

					update();

					//$("div#slot"+Active[i]).addClass("yellow");
					/*	$("div#slot"+Active[i]).attr("style","background: #f00 !important; transition: background 2s");*/
					//$("div#slot"+Active[i]).css('background', '#0f0');
					//$( "#toggle" ).toggle( "highlight" );

					setTimeout(function() {
						$("div#slot" + Active).toggle('highlight')
					}, 2);
					setTimeout(function() {
						$("div#slot" + Active).toggle('highlight')
					}, 4);


					//setTimeout(function() {doit(Active)}, 1); 
					//setTimeout(function() {undoit(Active)}, 4);

					start += 1;

					//var div = $('<div class="trans">');

					//div.animate({'width': '200px','background' :'red'}, 5000); // 5 sec animation
					//$(slotupdate)

				});
			});
		};
		function update() {
			//console.log("Slot "+count+" updated ");
			document.getElementById("outer").innerHTML = outer.innerHTML + "<div class='container'> <div id=slot" + count + ">Item " + count + "<span> " + created_date + "</span> <a href=" + url + " target='_blank'>" + title + "</a> <span>" + score + "&nbsp;pts.</span></div></div>";
		};
		/*		function doit(Active){
					$("div#slot"+Active).css('background', '#0f0');
				};
				
			function undoit(Active){
					$("div#slot"+Active).css('background', '#ccf')
			};*/
	</script>
</head>

<body>

	<h1> Demonstration Hacker&nbsp;News API&nbsp;feed</h1>
	<div class="hidden">
		Please wait for the news feed to initialise.</div>
	<div id="outer">

	</div>
</body>

</html>

<script>
	document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
</script>