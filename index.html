<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="robots" content="noindex" />
	<title>Raw Ideas News Hacker App test</title>
	<script src="http://code.jquery.com/jquery.min.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
	<script src="jquery.tmpl.min.js" type="text/javascript"></script>
	<script src="https://cdn.firebase.com/js/client/2.2.1/firebase.js"></script>

	<script>
		var newsItem = new Array();
		var ref = new Firebase("https://hacker-news.firebaseio.com/v0/");

		embedAngular("");

		function embedAngular(newsItems) {
			console.log("newsItem = " + newsItem);
			console.log("JSON newsItems = " + newsItems);
			angular.module('myApp', []).controller('namesCtrl', function($scope) {
				$scope.testword ="elephant";
				$scope.newsItems = newsItems;
				$scope.names = [{
					name: 'Jani',
					country: 'Norway'
				}, {
					name: 'Hege',
					country: 'Sweden'
				}, {
					name: 'Kai',
					country: 'Denmark'
				}];

			});
		}
		for (var i = 1; i < 11; i++) {
			getNews(i);
		};



		function getNews(i) {
			var itemRef;
			ref.child('topstories').child(i).on('value', function(snapshot) {
				if (itemRef) {
					itemRef.off();
				}
				var id = snapshot.val();
				itemRef = ref.child('item').child(id);
				itemRef.on('value', function(snapshot) {
					var item = snapshot.val();
					title = item.title;
					url = item.url;
					score = item.score;
					count = i;
					displayTopTenNews(title, score, url, count);
					createArray(title, score, url, count);
					/*			for (var indexNum = 1; i < 11; indexNum++) {
								console.log("count= "+indexNum + " data = " +newsData[indexNum]);
							};*/



					embedAngular(newsItem);


				});
			});

		};


		function displayTopTenNews(title, score, url, count) {
			$("div.hidden").remove();
			$("#clientTemplate").tmpl().appendTo("body");
		}

		function createArray(title, score, url, count) {
			newsItem[0]=count;
			newsItem[1] = title;
			newsItem[2] = score;
			newsItem[3] = url;

			var $items = $('#count, #title,#score,#url ')
			var obj = {}
			$items.each(function() {
				obj[this.id] = $(this).val();
			})

			//newsItems = JSON.stringify(obj);

			return

		}
	</script>
</head>

<body>
	<div class="hidden">
		When this is working, this text will not be seen - please wait.</div>
	<script id="clientTemplate" type="text/x-jquery-tmpl">
		News item ${count} is <a href=$ {url} target="_blank"> ${title} </a> and has a score of ${score}
		<br>
	</script>

	<div ng-app="myApp" ng-controller="namesCtrl">

		<ul>
			<li ng-repeat="x in names">
				{{ x.name + ', ' + x.country }}

			</li>
		</ul>
testword={{testword}}<br>
		newsItems = {{newsItems}}
		<br> names = {{names}}<br>
	

		<ul>
			<li ng-repeat="x in newsItems">
				{{ x.url + ', ' + x.title }}
			</li>
		</ul>


	</div>

</body>

</html>

<script>
	document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')
</script>